(function(){
  var _page = 1;
  var _totlePage = 0;
  var wjtjnfapwierV = new Vue({
    el:'#wjtjnfapwier',
    methods:{
      onSelect:function(event) {
        var $this = $(event.target);
        $('.wjtkalsdjfpae').show();
        $('.wjetjoaisodfhaoier').show();
        $('.wjtiuwer').hide();
      },
      onCenso:function(event) {
        $('.wjtkalsdjfpae').hide();
        $('.wjetjoaisodfhaoier').hide();
        $('.wjtiuwer').show();
      },
      onConmi:function(event){
        $('.wjtkalsdjfpae').hide();
        $('.wjetjoaisodfhaoier').hide();
        $('.wjtiuwer').show();
        var $che = $('.wjtaoiapiuehr:checked');
        var sts  =  new Array();
        $che.each(function(index, el) {
          sts[index] = $(el).val();
        });
        var qd = "";
        for (var i = 0; i < sts.length; i++) {
          qd=qd+"&id="+sts[i];
        }
        $.ajax({
          url: '/collection/delete/review?d=1'+qd,
          type: 'POST',
          dataType: 'json',
          cache:false,
        })
        .done(function(data) {
          if (data.status){
            ThisPage.renderStoreList();
            alert("删除成功");
          }else if (!data.isLogin){
            alert("登陆已经失效,请重新登陆");
          }
        })
        .fail(function() {
          console.log("delete error");
        });

      },
      onAllSel:function(event) {
        $('.wjtaoiapiuehr').trigger('click');
      }
    }
  });
  var wjtdfweiosdfV = new Vue({
    el: '#wjtdfweiosdf',
    data:{
      stores:[]
    }
  });
  var ThisPage = {
    run:function(){
        this.render();
        this.bind();
    },
    render: function(){
      this.renderStoreList();
    },
    bind:function(){
        $("#wjtsdfwep").on('click', 'a.ui-paging-item,a.ui-paging-next,a.ui-paging-prev', function () {
            $('.ui-paging-current').removeClass('ui-paging-current');
            $(this).addClass('ui-paging-current');
            var $this = $(this);
            _page = $this.attr('href');
            ThisPage.renderStoreList();
            $('html,body').animate({scrollTop: '170%'}, 1000);
            return false
        })
        .on('click', '.ui-paging-goto', function () {
            var $this = $(this)
            var $input = $this.prev('.ui-paging-which').find('input')
            var value = $input.val()
            // 必须填入数字
            value = parseInt(value, 10)
            if (isNaN(value)) {
                value = 1
            }
            if (value>_totlePage){
              _page=_totlePage;
            }
            ThisPage.renderStoreList();
            $('html,body').animate({scrollTop: '170%'}, 1000);
            return false;
        })
    },
    renderStoreList:function() {
      $.ajax({
        url: '/collection/_api/list/store',
        type: 'GET',
        dataType: 'json',
        cache:false,
      })
      .done(function(data) {
        console.log(data);
        if (data.status) {
          wjtdfweiosdfV.stores = data.data.stores;
          _page = data.data.paging.curPage;
          _totlePage=data.data.paging.totlePage;
          ThisPage.renderPaging();
        }else if (!data.isLogin){
          console.log("未登陆");
        }else{
          console.log("未知");
        }
      });
    },
    renderPaging:function() {
      var paginghtml = Paging.render({
          currentPage: _page,
          pageCount: _totlepage,
          link:''
      });
      $("#wjtsdfwep").empty();
      $("#wjtsdfwep").html(paginghtml);
    }
  };
  ThisPage.run();
})();
